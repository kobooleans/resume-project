<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ks.resumeproject.portfolio.repository.PortfolioMapper">

    <select id="categoryList" parameterType="AccountDto" resultType="CategoryDto">
        <![CDATA[
            SELECT CATEGORY_ID
                 , ID
                 , RANDOM_ID
                 , CATEGORY_NM
            FROM CATEGORY
            WHERE ID = #{id}
              AND RANDOM_ID = #{randomId}
            ORDER BY CATEGORY_ID
        ]]>
    </select>

    <insert id="insertCategory" parameterType="CategoryDto">
        <![CDATA[
            INSERT INTO CATEGORY
            ( CATEGORY_ID
            , ID
            , RANDOM_ID
            , CATEGORY_NM)
            SELECT COALESCE(NULLIF(MAX(CATEGORY_ID), 0), 0) + 1
                 , #{id}
                 , #{randomId}
                 , #{categoryNm}
            FROM CATEGORY
            WHERE ID = #{id}
              AND RANDOM_ID = #{randomId}
            ORDER BY MAX(CATEGORY_ID) DESC
        ]]>
    </insert>

    <update id="updateCategory" parameterType="CategoryDto">
        UPDATE CATEGORY
           SET CATEGORY_NM	= #{categoryNm}
         WHERE CATEGORY_ID	= #{categoryId}
           AND ID			= #{id}
           AND RANDOM_ID	= #{randomId}
        ;
    </update>

    <delete id="deleteCategory" parameterType="CategoryDto">
        DELETE FROM CATEGORY
         WHERE CATEGORY_ID	= #{categoryId}
           AND ID			= #{id}
           AND RANDOM_ID	= #{randomId}
    </delete>
</mapper>
